<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Certificate Verifier</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A simple class to hide elements, controlled by JavaScript */
        .hidden {
            display: none;
        }
        /* Simple transition for menu */
        #mobile-menu {
            transition: transform 0.3s ease-in-out;
        }
        /* Fade-in animation for login page */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        /* Simple spinner for AI buttons */
        .ai-spinner {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3B82F6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-blue-50 to-white font-sans">

    <div id="app-container">
        <!-- Navigation Bar -->
        <nav class="bg-white shadow-sm py-2 px-6 sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center">
                <!-- Back Button -->
                <button id="back-btn" class="hidden text-blue-600 hover:text-blue-800 p-2 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <!-- Logo -->
                <div id="nav-brand" class="flex items-center space-x-3 cursor-pointer">
                  <img src="logo.png" alt="CertiTrust Logo" class="h-10">
                  <span class="text-blue-700 font-bold text-xl hidden sm:block">
                    Smart Certificate Verifier
                  </span>
                </div>
                <!-- Hamburger Menu -->
                <div class="flex items-center">
                     <div class="relative hidden lg:block">
                        <select id="language-selector-desktop" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option selected>English (US)</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                            <option value="hi">हिन्दी</option>
                        </select>
                    </div>
                    <button id="menu-btn" class="text-blue-600 hover:text-blue-800 p-2 rounded-md ml-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Mobile Menu Dropdown -->
            <div id="mobile-menu" class="hidden absolute right-6 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                <a href="#" id="menu-home" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Home</a>
                <a href="#" id="menu-verify" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Verify</a>
                <a href="#" id="menu-history" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">History</a>
                <a href="#" id="menu-how-it-works" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">How It Works</a>
                <a href="#" id="menu-logout" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</a>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="container mx-auto px-4 py-8">
            
            <!-- Login Page Section -->
            <section id="login-page">
                 <div class="flex items-center justify-center min-h-[70vh]">
                    <div class="w-full max-w-4xl bg-white p-8 rounded-xl shadow-lg grid md:grid-cols-2 gap-12 items-center animate-fade-in">
                        <!-- Left Side: Illustration and Welcome Text -->
                        <div class="hidden md:block text-center">
                            <svg class="w-full h-auto" viewBox="0 0 553 388" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="25" y="72" width="418" height="288" rx="12" fill="#EBF5FF"/>
                                <path d="M41 88H402C409.732 88 416 94.268 416 102V334C416 341.732 409.732 348 402 348H41C33.268 348 27 341.732 27 334V102C27 94.268 33.268 88 41 88Z" fill="white"/>
                                <rect x="43" y="104" width="358" height="16" rx="4" fill="#F3F4F6"/>
                                <rect x="43" y="136" width="280" height="12" rx="4" fill="#F3F4F6"/>
                                <rect x="43" y="156" width="320" height="12" rx="4" fill="#F3F4F6"/>
                                <rect x="43" y="176" width="200" height="12" rx="4" fill="#F3F4F6"/>
                                <g filter="url(#filter0_d_101_2)">
                                <rect x="339" y="188" width="180" height="180" rx="12" fill="white"/>
                                <path d="M429 236C440.598 236 450 245.402 450 257C450 268.598 440.598 278 429 278C417.402 278 408 268.598 408 257C408 245.402 417.402 236 429 236Z" stroke="#34D399" stroke-width="8"/>
                                <path d="M417 257L425 265L441 249" stroke="#34D399" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                                <rect x="363" y="294" width="132" height="8" rx="4" fill="#F3F4F6"/>
                                <rect x="363" y="310" width="100" height="8" rx="4" fill="#F3F4F6"/>
                                </g>
                                <defs>
                                <filter id="filter0_d_101_2" x="323" y="176" width="212" height="212" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                                <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                                <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                                <feOffset dy="4"/>
                                <feGaussianBlur stdDeviation="8"/>
                                <feComposite in2="hardAlpha" operator="out"/>
                                <feColorMatrix type="matrix" values="0 0 0 0 0.0627451 0 0 0 0 0.0941176 0 0 0 0 0.156863 0 0 0 0.05 0"/>
                                <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_101_2"/>
                                <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_101_2" result="shape"/>
                                </filter>
                                </defs>
                            </svg>
                            <h3 class="text-2xl font-bold text-blue-800 mt-4">Secure Verification Portal</h3>
                            <p class="text-gray-500 mt-2">Authenticating documents with precision and integrity.</p>
                        </div>
                        <!-- Right Side: Login Form -->
                        <div>
                            <h2 class="text-3xl font-bold text-center text-blue-800 mb-6">Authorized Login</h2>
                            <p class="text-center text-gray-600 mb-8">This system is for authorized personnel only.</p>
                            <form id="login-form">
                                <div class="mb-4">
                                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                    <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="employee@gov.in" required>
                                </div>
                                <div class="mb-6">
                                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="••••••••" required>
                                </div>
                                <button type="submit" class="w-full py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition font-medium">Login</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Landing Page Section -->
            <section id="landing-page" class="hidden">
                <div class="flex flex-col items-center justify-center text-center py-16">
                    <h1 class="text-4xl md:text-5xl font-bold text-blue-800 mb-6">
                        Smart Certificate Verifier
                    </h1>
                    <p class="text-xl text-blue-600 mb-10 max-w-2xl">
                        Verify degrees and certificates instantly against the institutional database.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-6">
                        <button id="upload-cert-btn" class="px-8 py-4 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 transition duration-300 font-medium">
                            Upload Certificate
                        </button>
                        <button id="check-by-id-btn" class="px-8 py-4 border-2 border-blue-600 text-blue-600 rounded-lg shadow-md hover:bg-blue-50 transition duration-300 font-medium">
                            Check by Certificate ID
                        </button>
                    </div>

                    <!-- Features Section -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-20 text-left">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="text-blue-600 mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2 text-center">AI-Powered Verification</h3>
                            <p class="text-gray-600 text-center">Advanced algorithms analyze certificates for authenticity markers and detect forgeries.</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="text-blue-600 mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6a2 2 0 012-2zm10-4a2 2 0 11-4 0 2 2 0 014 0zM4 6a2 2 0 100 4h16a2 2 0 100-4H4z" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2 text-center">Secure Database</h3>
                            <p class="text-gray-600 text-center">Tamper-proof verification records stored on a secure institutional database.</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="text-blue-600 mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2 text-center">Instant Results</h3>
                            <p class="text-gray-600 text-center">Get verification results in seconds with detailed authenticity reports.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Upload Page Section -->
            <section id="upload-page" class="hidden">
                 <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-6 md:p-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-800 mb-6 text-center">Verify Certificate</h2>
                    <div class="space-y-6">
                        <!-- File Upload Section -->
                        <div id="drop-zone" class="border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors border-blue-300 bg-blue-50 hover:bg-blue-100">
                            <input type="file" id="file-input" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                            <div id="drop-zone-content">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-blue-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                <p class="text-blue-700 font-medium">Drag & Drop your certificate here</p>
                                <p class="text-sm text-blue-600 mt-2">or click to browse (PDF, JPG, PNG)</p>
                            </div>
                        </div>
                        <div class="text-center text-gray-500">- OR -</div>
                        <!-- Certificate ID Input -->
                        <div class="space-y-4">
                            <div>
                                <label for="certificate-id-input" class="block text-sm font-medium text-gray-700 mb-1">Certificate ID</label>
                                <input id="certificate-id-input" type="text" placeholder="Enter certificate ID" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="roll-number-input" class="block text-sm font-medium text-gray-700 mb-1">Roll Number (Optional)</label>
                                <input id="roll-number-input" type="text" placeholder="Enter roll number" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <!-- Verify Button -->
                        <button id="verify-btn" class="w-full py-3 rounded-md text-white font-medium transition bg-gray-400 cursor-not-allowed" disabled>
                            <span id="verify-btn-text">Verify Certificate</span>
                            <div id="loader" class="hidden items-center justify-center">
                                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Verifying...
                            </div>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Results Page Section -->
            <section id="results-page" class="hidden">
                 <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="p-6 md:p-8">
                        <h2 class="text-2xl md:text-3xl font-bold text-blue-800 mb-6 text-center">Verification Results</h2>
                        <div class="bg-gray-50 rounded-lg p-6 mb-6">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-semibold">Certificate Status</h3>
                                <span id="result-status-badge" class="px-3 py-1 rounded-full text-sm font-medium"></span>
                            </div>
                             <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold">Tamper Score</h3>
                                <span id="result-tamper-score" class="text-lg font-bold text-blue-800"></span>
                            </div>
                        </div>
                        <!-- GEMINI: AI Anomaly Report Section -->
                        <div id="anomaly-report-section" class="hidden bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6">
                            <h4 class="text-md font-semibold text-orange-800 mb-2">✨ AI Anomaly Analysis</h4>
                            <p id="anomaly-report-content" class="text-sm text-orange-700"></p>
                            <button id="generate-anomaly-report-btn" class="mt-3 text-sm flex items-center gap-2 px-3 py-1.5 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition">
                                <span id="anomaly-btn-text">Regenerate Analysis</span>
                                <div id="anomaly-spinner" class="ai-spinner hidden"></div>
                            </button>
                        </div>

                        <div class="border border-gray-200 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Certificate Details</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Name</p>
                                    <p id="result-name" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Roll Number</p>
                                    <p id="result-roll-number" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Course</p>
                                    <p id="result-course" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Issue Date</p>
                                    <p id="result-issue-date" class="font-medium"></p>
                                </div>
                                <div class="md:col-span-2">
                                    <p class="text-sm text-gray-600">Institution</p>
                                    <p id="result-institution" class="font-medium"></p>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="verify-another-btn" class="flex-1 py-3 bg-white border border-blue-600 text-blue-600 rounded-md hover:bg-blue-50 transition font-medium">
                                Verify Another
                            </button>
                            <button id="download-report-btn" class="flex-1 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition font-medium">
                                Download Report (PDF)
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                        <p class="text-sm text-gray-500 text-center">
                            Need help? Contact support@certverifier.example.com
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- History Page Section -->
            <section id="history-page" class="hidden">
                 <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6 md:p-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-800 mb-6 text-center">Verification History</h2>
                    <div id="history-list" class="space-y-4">
                        <!-- History items will be injected here by JavaScript -->
                         <p id="no-history-msg" class="text-center text-gray-500">No verification history found.</p>
                    </div>
                </div>
            </section>
            
            <!-- How It Works Page Section -->
            <section id="how-it-works-page" class="hidden">
                <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6 md:p-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-800 mb-6">How This Site Works</h2>
                    <div class="prose max-w-none">
                        <h3 class="text-xl font-semibold mt-4">Verification Process:</h3>
                        <ol class="list-decimal list-inside space-y-4">
                            <li><strong>Upload & Preprocessing:</strong> The user (e.g., an employer or administrator) uploads the certificate file (PDF, JPG). The system preprocesses the image to de-skew, remove noise, and enhance contrast for better accuracy.</li>
                            <li><strong>OCR Extraction:</strong> An Optical Character Recognition (OCR) engine extracts key fields like Student Name, Roll Number, Degree, Year of Passing, and Certificate ID. This data is structured into a JSON format with confidence scores for each field.</li>
                            <li><strong>Database Matching:</strong> The extracted data is matched against the institution's secure, verified database. Roll Number and Certificate ID are checked for an exact match, while names and courses use fuzzy matching to account for minor typos. A failure to match results in an "Invalid (Fake)" status.</li>
                            <li><strong>Forgery Detection:</strong> The system performs several checks to detect tampering. This includes analyzing file metadata for inconsistencies, comparing signatures and seals against verified templates, and detecting font or style mismatches. These checks contribute to a weighted "Tamper Score."</li>
                            <li><strong>Decision & Output:</strong> A final decision is made based on the findings. If the record matches and the Tamper Score is below the defined threshold, the result is "Valid." If the record matches but the score is high, the result is "Suspect," indicating a need for manual review. The result, including the Tamper Score, is displayed to the user.</li>
                        </ol>

                        <h3 class="text-xl font-semibold mt-6">Future Vision:</h3>
                        <ul class="list-disc list-inside space-y-2">
                            <li>Integrate blockchain to store a SHA-256 hash of new digital certificates for immutable verification.</li>
                            <li>Enable QR code scanning on certificates for instant, direct verification against the database.</li>
                            <li>Develop a centralized, state-level repository to consolidate verification data from multiple universities.</li>
                        </ul>
                    </div>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 py-8 mt-16">
            <div class="container mx-auto px-4 text-center md:text-left">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Contact Info -->
                    <div>
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Contact Information</h3>
                        <div class="space-y-1 text-gray-600">
                            <p><strong>Name:</strong> [Your Department/Institution Name]</p>
                            <p><strong>Email:</strong> [your.email@example.com]</p>
                            <p><strong>Phone:</strong> [Your Phone Number]</p>
                        </div>
                    </div>
                    
                    <!-- Raise a Question -->
                    <div>
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Raise a Question</h3>
                        <form id="support-form">
                            <textarea id="support-textarea" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Type your question here..."></textarea>
                            <div class="flex items-center gap-2 mt-2">
                                <button type="submit" class="w-full md:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition font-medium">Submit Question</button>
                                <!-- GEMINI: AI Draft Ticket Button -->
                                <button type="button" id="draft-ticket-btn" class="hidden flex items-center gap-2 w-full md:w-auto px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition font-medium">
                                    <span id="draft-btn-text">✨ Draft with AI</span>
                                     <div id="draft-spinner" class="ai-spinner hidden"></div>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Quick Links -->
                    <div>
                         <h3 class="text-lg font-semibold text-blue-800 mb-2">Quick Links</h3>
                         <div class="flex flex-col space-y-1">
                            <a href="#" class="text-gray-600 hover:text-blue-600">Privacy Policy</a>
                            <a href="#" class="text-gray-600 hover:text-blue-600">Terms of Service</a>
                            <a href="#" id="footer-how-it-works" class="text-gray-600 hover:text-blue-600">How It Works</a>
                        </div>
                    </div>
                </div>
                <div class="mt-8 border-t border-gray-200 pt-4 text-center text-gray-500 text-sm">
                    &copy; <span id="copyright-year"></span> Smart Certificate Verifier. All rights reserved.
                </div>
            </div>
        </footer>
        <!-- Global Error Modal -->
        <div id="error-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
             <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                <h3 class="text-lg font-bold text-red-700">Error</h3>
                <p id="error-message" class="text-gray-600 mt-2">An unexpected error occurred.</p>
                <button id="close-error-modal" class="mt-4 w-full py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Close</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let currentPage = 'login';
            let pageHistory = [];
            let verificationHistory = [];
            let verificationStatus = null;
            let loading = false;
            let file = null;

            // --- DOM ELEMENT REFERENCES ---
            const allPages = document.querySelectorAll('main section');
            const nav = document.querySelector('nav');
            const loginForm = document.getElementById('login-form');
            const backBtn = document.getElementById('back-btn');
            const navBrand = document.getElementById('nav-brand');
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuItems = {
                home: document.getElementById('menu-home'),
                verify: document.getElementById('menu-verify'),
                history: document.getElementById('menu-history'),
                howItWorks: document.getElementById('menu-how-it-works'),
                logout: document.getElementById('menu-logout'),
            };
            const uploadCertBtn = document.getElementById('upload-cert-btn');
            const checkByIdBtn = document.getElementById('check-by-id-btn');
            const dropZone = document.getElementById('drop-zone');
            const dropZoneContent = document.getElementById('drop-zone-content');
            const fileInput = document.getElementById('file-input');
            const certificateIdInput = document.getElementById('certificate-id-input');
            const rollNumberInput = document.getElementById('roll-number-input');
            const verifyBtn = document.getElementById('verify-btn');
            const verifyBtnText = document.getElementById('verify-btn-text');
            const loader = document.getElementById('loader');

            // Results Page & AI Anomaly
            const anomalyReportSection = document.getElementById('anomaly-report-section');
            const anomalyReportContent = document.getElementById('anomaly-report-content');
            const generateAnomalyReportBtn = document.getElementById('generate-anomaly-report-btn');
            const anomalyBtnText = document.getElementById('anomaly-btn-text');
            const anomalySpinner = document.getElementById('anomaly-spinner');
            const resultStatusBadge = document.getElementById('result-status-badge');
            const resultTamperScore = document.getElementById('result-tamper-score');
            const resultName = document.getElementById('result-name');
            const resultRollNumber = document.getElementById('result-roll-number');
            const resultCourse = document.getElementById('result-course');
            const resultIssueDate = document.getElementById('result-issue-date');
            const resultInstitution = document.getElementById('result-institution');
            const verifyAnotherBtn = document.getElementById('verify-another-btn');
            const downloadReportBtn = document.getElementById('download-report-btn');
            
            // History Page
            const historyList = document.getElementById('history-list');
            const noHistoryMsg = document.getElementById('no-history-msg');
            
            // Footer & AI Support
            const copyrightYear = document.getElementById('copyright-year');
            const footerHowItWorks = document.getElementById('footer-how-it-works');
            const supportTextarea = document.getElementById('support-textarea');
            const draftTicketBtn = document.getElementById('draft-ticket-btn');
            const draftBtnText = document.getElementById('draft-btn-text');
            const draftSpinner = document.getElementById('draft-spinner');

             // Error Modal
            const errorModal = document.getElementById('error-modal');
            const errorMessage = document.getElementById('error-message');
            const closeErrorModal = document.getElementById('close-error-modal');

            // --- GEMINI API INTEGRATION ---
            const API_KEY = ""; // Leave empty, will be handled by the environment
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            
            async function callGeminiAPI(userPrompt, systemPrompt, retries = 3) {
                const payload = {
                    contents: [{ parts: [{ text: userPrompt }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.json();
                        throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorBody.error?.message}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return candidate.content.parts[0].text;
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    if (retries > 0) {
                        console.warn(`API call failed, retrying... (${retries} attempts left)`);
                        await new Promise(res => setTimeout(res, (4 - retries) * 1000)); // Exponential backoff
                        return callGeminiAPI(userPrompt, systemPrompt, retries - 1);
                    }
                    console.error("Error calling Gemini API:", error);
                    showErrorModal(error.message);
                    return null;
                }
            }
            
            // --- CORE LOGIC FUNCTIONS ---
            
            const showErrorModal = (message) => {
                errorMessage.textContent = message || "An unexpected error occurred. Please try again later.";
                errorModal.classList.remove('hidden');
            };

            const hideErrorModal = () => {
                errorModal.classList.add('hidden');
            };

            const showNav = (show) => {
                nav.classList.toggle('hidden', !show);
            };

            const navigateTo = (page, isBack = false) => {
                if (currentPage === page) return; 
                if (!isBack && currentPage !== 'login') {
                    pageHistory.push(currentPage);
                }
                currentPage = page;
                document.querySelectorAll('main section').forEach(p => p.classList.add('hidden'));
                document.getElementById(`${page}-page`).classList.remove('hidden');
                backBtn.classList.toggle('hidden', pageHistory.length === 0 || page === 'login');
                showNav(page !== 'login');
                if (page === 'history') renderHistory();
                mobileMenu.classList.add('hidden');
                window.scrollTo(0, 0);
            };
            
            const handleBack = () => {
                const lastPage = pageHistory.pop();
                if (lastPage) navigateTo(lastPage, true);
            };
            
            const handleLogin = (e) => {
                e.preventDefault();
                pageHistory = [];
                navigateTo('landing');
            };
            
            const handleLogout = () => {
                pageHistory = [];
                verificationHistory = [];
                resetVerification();
                navigateTo('login');
            };

            const updateFileDisplay = () => {
                if (file) {
                    dropZone.className = 'border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors border-green-500 bg-green-50';
                    dropZoneContent.innerHTML = `<p class="text-green-700 font-medium">${file.name}</p><p class="text-sm text-green-600 mt-2">Click or drag to change file</p>`;
                } else {
                    dropZone.className = 'border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors border-blue-300 bg-blue-50 hover:bg-blue-100';
                    dropZoneContent.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-blue-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg><p class="text-blue-700 font-medium">Drag & Drop your certificate here</p><p class="text-sm text-blue-600 mt-2">or click to browse (PDF, JPG, PNG)</p>`;
                }
                updateVerifyButtonState();
            };

            const updateVerifyButtonState = () => {
                const hasFile = file !== null;
                const hasId = certificateIdInput.value.trim() !== '';
                const canVerify = hasFile || hasId;
                verifyBtn.disabled = loading || !canVerify;
                verifyBtn.className = `w-full py-3 rounded-md text-white font-medium transition ${!canVerify || loading ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'}`;
            };
            
            const renderResults = () => {
                if (!verificationStatus) return;
                const { status, details, tamperScore } = verificationStatus;
                
                resultStatusBadge.className = 'px-3 py-1 rounded-full text-sm font-medium';
                resultTamperScore.textContent = `${tamperScore}/100`;
                anomalyReportSection.classList.add('hidden');

                if (status === 'valid') {
                    resultStatusBadge.classList.add('bg-green-100', 'text-green-800');
                    resultStatusBadge.textContent = '✅ Valid';
                    resultTamperScore.className = 'text-lg font-bold text-green-700';
                } else if (status === 'suspect') {
                    resultStatusBadge.classList.add('bg-yellow-100', 'text-yellow-800');
                    resultStatusBadge.textContent = '⚠️ Suspect';
                    resultTamperScore.className = 'text-lg font-bold text-yellow-700';
                    anomalyReportSection.classList.remove('hidden');
                    anomalyReportContent.textContent = 'Click the button below to generate an AI analysis of potential issues.';
                    anomalyBtnText.textContent = '✨ Generate Analysis';
                } else { // Invalid
                    resultStatusBadge.classList.add('bg-red-100', 'text-red-800');
                    resultStatusBadge.textContent = '❌ Invalid (Fake)';
                    resultTamperScore.className = 'text-lg font-bold text-red-700';
                }
                
                resultName.textContent = details.name;
                resultRollNumber.textContent = details.rollNumber;
                resultCourse.textContent = details.course;
                resultIssueDate.textContent = details.issueDate;
                resultInstitution.textContent = details.institution;
            };
            
            const renderHistory = () => {
                historyList.innerHTML = '';
                if (verificationHistory.length === 0) {
                    noHistoryMsg.classList.remove('hidden');
                } else {
                    noHistoryMsg.classList.add('hidden');
                    verificationHistory.forEach(item => {
                        let statusClass, statusText;
                        if(item.status === 'valid') {
                            statusClass = 'bg-green-100 text-green-800';
                            statusText = 'Valid';
                        } else if (item.status === 'suspect') {
                            statusClass = 'bg-yellow-100 text-yellow-800';
                            statusText = 'Suspect';
                        } else {
                            statusClass = 'bg-red-100 text-red-800';
                            statusText = 'Invalid';
                        }
                        
                        const li = document.createElement('div');
                        li.className = 'bg-gray-50 p-4 rounded-lg border border-gray-200';
                        li.innerHTML = `<div class="flex justify-between items-center"><div><p class="font-semibold">${item.details.name} - ${item.details.course}</p><p class="text-sm text-gray-500">Roll No: ${item.details.rollNumber} | Verified: ${new Date().toLocaleString()}</p></div><span class="px-3 py-1 rounded-full text-sm font-medium ${statusClass}">${statusText}</span></div>`;
                        historyList.appendChild(li);
                    });
                }
            };
            
            // --- EVENT HANDLER FUNCTIONS ---

            const handleFileSelect = (selectedFile) => {
                if (selectedFile) {
                    file = selectedFile;
                    updateFileDisplay();
                }
            };

            const simulateVerification = () => {
                loading = true;
                loader.classList.remove('hidden');
                loader.classList.add('flex');
                verifyBtnText.classList.add('hidden');
                updateVerifyButtonState();

                setTimeout(() => {
                    const statuses = ['valid', 'invalid', 'suspect'];
                    const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                    
                    let tamperScore = 0;
                    if (randomStatus === 'valid') {
                        tamperScore = Math.floor(Math.random() * 20); // 0-19
                    } else if (randomStatus === 'suspect') {
                        tamperScore = Math.floor(Math.random() * 40) + 60; // 60-99
                    } else { // invalid
                        tamperScore = Math.floor(Math.random() * 30) + 30; // 30-59 (can have some anomalies but main issue is no record)
                    }

                    verificationStatus = {
                        status: randomStatus,
                        tamperScore: tamperScore,
                        details: {
                            name: "John Doe",
                            rollNumber: rollNumberInput.value || "123456",
                            course: "Bachelor of Science in Computer Science",
                            issueDate: "May 15, 2022",
                            institution: "Tech University"
                        }
                    };
                    verificationHistory.unshift(verificationStatus);
                    
                    loading = false;
                    loader.classList.add('hidden');
                    loader.classList.remove('flex');
                    verifyBtnText.classList.remove('hidden');
                    
                    renderResults();
                    navigateTo('results');
                }, 2000);
            };
            
            const handleGenerateAnomalyReport = async () => {
                if (!verificationStatus) return;
                
                anomalySpinner.classList.remove('hidden');
                anomalyBtnText.textContent = 'Analyzing...';
                generateAnomalyReportBtn.disabled = true;

                const systemPrompt = "You are a security analyst for a document verification system. Provide a brief, professional, bulleted list of 2-3 hypothetical reasons why a certificate might be flagged as 'Suspect'. Do not state that you are an AI. Be concise.";
                const userPrompt = `A certificate for "${verificationStatus.details.name}" was flagged as "Suspect" with a tamper score of ${verificationStatus.tamperScore}. What are some potential reasons for this flag?`;
                
                const report = await callGeminiAPI(userPrompt, systemPrompt);
                if (report) {
                    anomalyReportContent.textContent = report;
                } else {
                    anomalyReportContent.textContent = "Could not generate analysis. Please try again.";
                }

                anomalySpinner.classList.add('hidden');
                anomalyBtnText.textContent = 'Regenerate Analysis';
                generateAnomalyReportBtn.disabled = false;
            };
            
            const handleDraftTicket = async () => {
                const userInput = supportTextarea.value;
                if (userInput.trim().length < 10) {
                    showErrorModal("Please provide more details in your query before using the AI assistant.");
                    return;
                }

                draftSpinner.classList.remove('hidden');
                draftBtnText.textContent = 'Drafting...';
                draftTicketBtn.disabled = true;

                const systemPrompt = "You are an IT support assistant for a secure portal. Expand the user's brief query into a professional support ticket. Structure it with a clear 'Subject', 'Description of Issue', and 'Requested Action'. Be helpful and formal.";
                const userPrompt = `Please expand the following user query into a formal support ticket: "${userInput}"`;

                const draft = await callGeminiAPI(userPrompt, systemPrompt);
                if (draft) {
                    supportTextarea.value = draft;
                }

                draftSpinner.classList.add('hidden');
                draftBtnText.textContent = '✨ Draft with AI';
                draftTicketBtn.disabled = false;
            };

            const resetVerification = () => {
                file = null;
                certificateIdInput.value = '';
                rollNumberInput.value = '';
                verificationStatus = null;
                updateFileDisplay();
                navigateTo('upload');
            };

            // --- ATTACHING EVENT LISTENERS ---

            loginForm.addEventListener('submit', handleLogin);
            backBtn.addEventListener('click', handleBack);
            navBrand.addEventListener('click', () => navigateTo('landing'));
            menuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            
            Object.values(menuItems).forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = e.target.id.split('-')[1];
                    if (pageId === 'logout') handleLogout();
                    else navigateTo(`${pageId}${pageId === 'how' ? '-it-works' : ''}`);
                });
            });

            uploadCertBtn.addEventListener('click', () => navigateTo('upload'));
            checkByIdBtn.addEventListener('click', () => {
                navigateTo('upload');
                certificateIdInput.focus();
            });

            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', (e) => e.preventDefault());
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                handleFileSelect(e.dataTransfer.files[0]);
            });
            fileInput.addEventListener('change', (e) => handleFileSelect(e.target.files[0]));

            certificateIdInput.addEventListener('input', updateVerifyButtonState);
            rollNumberInput.addEventListener('input', updateVerifyButtonState);
            verifyBtn.addEventListener('click', simulateVerification);
            verifyAnotherBtn.addEventListener('click', resetVerification);
            downloadReportBtn.addEventListener('click', () => alert("This would download a PDF report in a real application."));
            footerHowItWorks.addEventListener('click', (e) => { e.preventDefault(); navigateTo('how-it-works'); });
            
            // AI Feature Listeners
            generateAnomalyReportBtn.addEventListener('click', handleGenerateAnomalyReport);
            supportTextarea.addEventListener('input', () => {
                draftTicketBtn.classList.toggle('hidden', supportTextarea.value.trim().length === 0);
            });
            draftTicketBtn.addEventListener('click', handleDraftTicket);
            
            // Error Modal
            closeErrorModal.addEventListener('click', hideErrorModal);

            // --- INITIALIZATION ---
            copyrightYear.textContent = new Date().getFullYear();
            navigateTo('login', true);
        });
    </script>
</body>
</html>


